<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  The Trapped Knight · Michael Haneman
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Michael Haneman">
<meta name="description" content="Introduction Link to heading A little while ago while browing through the youtube channel Numberphile, I came across a video about this simulation called &ldquo;The Trapped Knight&rdquo;. Given some simple rules, some intersting chaotic patterns emerge.
Feel free to watch before continuing, but the rules will be summarized below.
Rules summary Link to heading Let&rsquo;s quickly layout the rules descripted in the video.
Suppose an infinitly large chessboard with a point of origin, labled with the numeric value of &ldquo;zero&rdquo;.">
<meta name="keywords" content="blog,developer,personal">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="The Trapped Knight">
  <meta name="twitter:description" content="Introduction Link to heading A little while ago while browing through the youtube channel Numberphile, I came across a video about this simulation called “The Trapped Knight”. Given some simple rules, some intersting chaotic patterns emerge.
Feel free to watch before continuing, but the rules will be summarized below.
Rules summary Link to heading Let’s quickly layout the rules descripted in the video.
Suppose an infinitly large chessboard with a point of origin, labled with the numeric value of “zero”.">

<meta property="og:url" content="http://localhost:1313/posts/trapped-knight/">
  <meta property="og:site_name" content="Michael Haneman">
  <meta property="og:title" content="The Trapped Knight">
  <meta property="og:description" content="Introduction Link to heading A little while ago while browing through the youtube channel Numberphile, I came across a video about this simulation called “The Trapped Knight”. Given some simple rules, some intersting chaotic patterns emerge.
Feel free to watch before continuing, but the rules will be summarized below.
Rules summary Link to heading Let’s quickly layout the rules descripted in the video.
Suppose an infinitly large chessboard with a point of origin, labled with the numeric value of “zero”.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-05T15:58:27-07:00">
    <meta property="article:modified_time" content="2024-05-05T15:58:27-07:00">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Manim">
    <meta property="article:tag" content="Matplotlib">




<link rel="canonical" href="http://localhost:1313/posts/trapped-knight/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Michael Haneman
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/contact/">Contact me</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/trapped-knight/">
              The Trapped Knight
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-05-05T15:58:27-07:00">
                May 5, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
    <a href="/authors/michael-haneman/">Michael Haneman</a></div>

          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/simulation/">Simulation</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/python/">Python</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/manim/">Manim</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/matplotlib/">Matplotlib</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h1 id="introduction">
  Introduction
  <a class="heading-link" href="#introduction">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>A little while ago while browing through the youtube channel Numberphile, I came across a video about this simulation called &ldquo;The Trapped Knight&rdquo;. Given some simple rules, some intersting chaotic patterns emerge.</p>
<p>Feel free to watch before continuing, but the rules will be summarized below.</p>


    
    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/RGQe8waGJ4w?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"
      ></iframe>
    </div>

<h1 id="rules-summary">
  Rules summary
  <a class="heading-link" href="#rules-summary">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Let&rsquo;s quickly layout the rules descripted in the video.</p>
<ol>
<li>Suppose an infinitly large chessboard with a point of origin, labled with the numeric value of &ldquo;zero&rdquo;.</li>
<li>From this origin, the rest of the real integers will be labled on the other squares in a spiral shape.</li>
<li>The knight will start at the origin</li>
<li>The knight will move to the square with the lowest value that has not been visited yet</li>
</ol>
<p>(insert manim graph)</p>
<p>For generating the spiral shape, two decisions have to be made. Firstly, which square around the origin will contain the value of &ldquo;one&rdquo;: The top, bottom, left, or right square? Which direction will the spiral be generated: clockwise or counter clockwise? Ultimatly, these decisions are abritrary because changing these conditions will create reflections and rotations in the eventual graph. The shape and logic are not dependent on these decisions. However to match the results found in the video, the square with the value of &ldquo;one&rdquo; with start on the square below the origin and the spiral will be produced counter-clockwise.</p>
<h1 id="result">
  Result
  <a class="heading-link" href="#result">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>


    
    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/ZXOjEcl4wm4?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"
      ></iframe>
    </div>

<h1 id="a-tour-of-the-code">
  A Tour of the Code
  <a class="heading-link" href="#a-tour-of-the-code">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<h2 id="generating-the-spiral">
  Generating the Spiral
  <a class="heading-link" href="#generating-the-spiral">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>To Generate the spiral, we will keep track of a 2d vector that rotates 90 degrees after it has moved m squares.
The number of squares the vector will move will be m+1 after 2 rotations.
Technically, we could need an infinite number of values squares to run this simulation. But, we will artifically cap the size of the sprial at <code>spiral_size</code>.</p>
<pre tabindex="0"><code>def gen_spiral(self, spiral_size, negate_primes):
        square_length = 1
        dir = [0, 1]
        current_square = [0, 0]
        current_value = 0

        for _ in range(0, spiral_size):
            for _ in range(0, 2):
                for _ in range(0, square_length):
                    self.coord_vals[tuple(current_square)] = current_value
                    current_square = [sum(i) for i in zip(current_square, dir)]
                    current_value += 1
                dir = self.rot_vec2_90(dir)
            square_length += 1
</code></pre><h2 id="moving-the-knight-and-checking-visited-squares">
  Moving the knight and checking visited squares
  <a class="heading-link" href="#moving-the-knight-and-checking-visited-squares">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>We will have a base class called Knight. But why? Why not just implement everything in the knight class? In the future, we may want to create new rules to apply to the knight. So, for each implementation of these rules, the Knight class will be inherited and the abstract method <code>find_next_square</code> will be implemented. In this way, each implementation is organized in each class and we will not have to duplicate the basic code for the knight.</p>
<pre tabindex="0"><code>class Knight:

    def __init__(self, start_pos: tuple = (0,0)) -&gt; None:
        self.curr_pos = start_pos
        self.move_offsets = [(1, 2), (-1, 2), (1, -2), (-1, -2), (2, 1), (-2, 1), (2, -1), (-2, -1)]
        self.pos_history = []
</code></pre><p>Lets implement the rules for finding the next square in a class called <code>NKnight</code>. Its called NKnight because n represents the nth lowest value the knight will go to. For example, if n=0 and we have the possible square values <code>[2, 9, 5]</code>, the knight will go to the square wil value 2. For n=1, the knight will go to the square with value 5. n=3, square with value 9. n=4, since there are only three options, we must take the square with value 9.</p>
<pre tabindex="0"><code>class NKnight(Knight):
    def __init__(self, n=0, start_pos: tuple = (0,0)) -&gt; None:
        Knight.__init__(self, start_pos)
        self.n = n

    def find_next_square(self, coord_vals: Dict[tuple, int])-&gt; Optional[tuple]:
    ...
</code></pre><p>First, lets collect all the possible squares the knight can go to.</p>
<p>The intuative approach to marking visited squares will be to have a list of coordinates. Each time the knight moves to a new square, the coordinate is appended to this list. The problem with this approach is, everytime we check if a square is visited, validating if the value is in this list is an O(n) time complexity and O(n) memory. For example, if the knight is on move 10,000 and the next lowest valid square needs to be found. For each of the eight possible knight moves, we need to check if that specific coordinate exist inside of this list. In total, 80,000 list elements need to be checked.</p>
<p>So instead, we will modify the value of the square when visited. To mark a visitation, the value of the square will become negative. Therefore for each of the eight squares, we just need to check that it is greater than or equal to zero.</p>
<pre tabindex="0"><code>    def find_next_square(self, coord_vals: Dict[tuple, int])-&gt; Optional[tuple]:
        visited = []
        
        for offset in self.move_offsets:
            pot_pos = tuple(map(lambda i, j: i + j, offset, self.curr_pos))
            pot_val = coord_vals[pot_pos]

            if pot_val &gt; 0:
                visited.append((pot_pos, pot_val))

        if len(visited) == 0:
            return None
</code></pre><p>This is the logic for calculating each step of the knight moves. Notice how we will return False when the knight is trapped.</p>
<pre tabindex="0"><code>def calc_move(self) -&gt; bool:
        next_pos = self.knight.find_next_square(self.board.coord_vals)
        
        if next_pos is None:
            return False

        self.board.coord_vals[next_pos] *= -1 # update board
        return True
</code></pre><p>Next, lets sort the array of avaliable squares by value. We want the lowest value squares so that way we can treat this list like a stack an pop off the lowest value form the end.</p>
<pre tabindex="0"><code>
        visited.sort(reverse=True, key=lambda e: e[1])

        for _ in range(self.n):
            if (len(visited) == 1):
                break
            visited.pop()

        result = visited.pop()[0]
        self.curr_pos = result
        self.pos_history.append(result)
        return result
</code></pre><p>Link to source code on github:
<a href="https://github.com/mhaneman/trapped-knight/tree/main"  class="external-link" target="_blank" rel="noopener">https://github.com/mhaneman/trapped-knight/tree/main</a></p>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     Michael Haneman 
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
